/* Consider the following schema for a Library Database:
BOOK (Book_ID, Title, Pub_Name, Pub_Year)
BOOK_AUTHORS (Book_ID, Author_Name)
PUBLISHER (Pub_ID, Pub_Name, Address, Phone)
BOOK_COPIES (Book_ID, PGM_ID, No_of_Copies) 
BOOK_LENDING (Book_ID, PGM_ID, Card_No, Date_Out, Due_Date) 
LIBRARY_PROGRAM (PGM_ID, PGM_Name, Address) */

CREATE TABLE PUBLISHER (
    PUB_ID INT PRIMARY KEY,
    PUB_NAME VARCHAR(20) UNIQUE,
    ADDRESS VARCHAR(20),
    PHONE BIGINT
);

CREATE TABLE BOOK (
    BOOK_ID INT PRIMARY KEY,
    TITLE VARCHAR(20),
    PUB_NAME VARCHAR(20),
    FOREIGN KEY (PUB_NAME)
        REFERENCES PUBLISHER (PUB_NAME)
        ON DELETE CASCADE,
    PUB_YEAR INT
);

CREATE TABLE LIBRARY_PROGRAM (
    PGM_ID INT PRIMARY KEY,
    PGM_NAME VARCHAR(20),
    ADDRESS VARCHAR(30)
);

CREATE TABLE BOOK_AUTHORS (
    BOOK_ID INT,
    AUTHOR_NAME VARCHAR(20),
    PRIMARY KEY (BOOK_ID , AUTHOR_NAME),
    FOREIGN KEY (BOOK_ID)
        REFERENCES BOOK (BOOK_ID)
        ON DELETE CASCADE
);

CREATE TABLE BOOK_COPIES (
    BOOK_ID INT,
    PGM_ID INT,
    NO_OF_COPIES INT,
    PRIMARY KEY (BOOK_ID , PGM_ID),
    FOREIGN KEY (BOOK_ID)
        REFERENCES BOOK (BOOK_ID)
        ON DELETE CASCADE,
    FOREIGN KEY (PGM_ID)
        REFERENCES LIBRARY_PROGRAM (PGM_ID)
        ON DELETE CASCADE
);

CREATE TABLE BOOK_LENDING (
    BOOK_ID INT,
    PGM_ID INT,
    CARD_NO INT,
    DATE_OUT DATE,
    DUE_DATE DATE,
    PRIMARY KEY (BOOK_ID , PGM_ID , CARD_NO),
    FOREIGN KEY (BOOK_ID)
        REFERENCES BOOK (BOOK_ID)
        ON DELETE CASCADE,
    FOREIGN KEY (PGM_ID)
        REFERENCES LIBRARY_PROGRAM (PGM_ID)
        ON DELETE CASCADE
);





INSERT INTO PUBLISHER VALUES (501,'KVS','BANGALORE',9535616745);
INSERT INTO PUBLISHER VALUES (502,'WESTLAND','PUNE',8768916745); 
INSERT INTO PUBLISHER VALUES (503,'RUPA','BANGALORE',6478989715); 
INSERT INTO PUBLISHER VALUES (504,'GANGA','MUMBAI',9876985645); 
INSERT INTO PUBLISHER VALUES (505,'HACHETTE','MATTUR',7013458745);

SELECT 
    *
FROM
    PUBLISHER;


INSERT INTO BOOK VALUES (001,'MCGRAW-HILL','GANGA',2001); 
INSERT INTO BOOK VALUES (002,'MY ARTEMIS','KVS',2004);
INSERT INTO BOOK VALUES (003,'CHEMISTRY VOL 1','WESTLAND',2006); 
INSERT INTO BOOK VALUES (004,'UPRISING','RUPA',2018);
INSERT INTO BOOK VALUES (005,'CHEMISTRY VOL 2','WESTLAND',2021);

SELECT 
    *
FROM
    BOOK;


INSERT INTO LIBRARY_PROGRAM VALUES (101,'BOOK AXIS','BANGALORE'); 
INSERT INTO LIBRARY_PROGRAM VALUES (102,'BOOK SQUARE','PUNE'); 
INSERT INTO LIBRARY_PROGRAM VALUES (103,'CLAUS BOOKS','MUMBAI'); 
INSERT INTO LIBRARY_PROGRAM VALUES (104,'COMIC CON','PUNE'); 
INSERT INTO LIBRARY_PROGRAM VALUES (105,'FANDOM','BANGALORE');

SELECT 
    *
FROM
    LIBRARY_PROGRAM;


INSERT INTO BOOK_AUTHORS VALUES (001, 'ASHISH C'); 
INSERT INTO BOOK_AUTHORS VALUES (002, 'ANEESHA'); 
INSERT INTO BOOK_AUTHORS VALUES (003, 'ADITYA KUL C'); 
INSERT INTO BOOK_AUTHORS VALUES (004, 'SAQUIB M'); 
INSERT INTO BOOK_AUTHORS VALUES (005, 'ARJUN S');

SELECT 
    *
FROM
    BOOK_AUTHORS;


INSERT INTO BOOK_COPIES VALUES (001, 102, 40); 
INSERT INTO BOOK_COPIES VALUES (002, 101, 18); 
INSERT INTO BOOK_COPIES VALUES (003, 104, 53); 
INSERT INTO BOOK_COPIES VALUES (004, 103, 4); 
INSERT INTO BOOK_COPIES VALUES (005, 105, 20);

SELECT 
    *
FROM
    BOOK_COPIES;


INSERT INTO BOOK_LENDING VALUES (001, 101, 5001, '2021-09-21', '2021-10-19'); 
INSERT INTO BOOK_LENDING VALUES (001, 102, 5002, '2017-01-07', '2017-05-18'); 
INSERT INTO BOOK_LENDING VALUES (002, 102, 5003, '2017-02-02', '2020-03-22'); 
INSERT INTO BOOK_LENDING VALUES (003, 103, 5004, '2016-09-14', '2021-10-08'); 
INSERT INTO BOOK_LENDING VALUES (005, 104, 5005, '2020-06-18', '2021-08-14'); 
INSERT INTO BOOK_LENDING VALUES (002, 102, 5002, '2017-01-07', '2017-05-18'); 
INSERT INTO BOOK_LENDING VALUES (003, 102, 5002, '2017-02-02', '2020-03-22'); 
INSERT INTO BOOK_LENDING VALUES (004, 102, 5002, '2017-03-14', '2019-05-08');

SELECT 
    *
FROM
    BOOK_LENDING;





/* 1) Retrieve details of all books in the library â€“ id, title, name of publisher, 
authors, number of copies in each program, etc. */
SELECT 
    LP.PGM_NAME,
    B.BOOK_ID,
    TITLE,
    P.PUB_NAME,
    AUTHOR_NAME,
    NO_OF_COPIES
FROM
    BOOK B,
    BOOK_AUTHORS BA,
    BOOK_COPIES BC,
    LIBRARY_PROGRAM LP,
    PUBLISHER P
WHERE
    B.BOOK_ID = BA.BOOK_ID
        AND BA.BOOK_ID = BC.BOOK_ID
        AND BC.PGM_ID = LP.PGM_ID
        AND B.PUB_NAME = P.PUB_NAME
GROUP BY LP.PGM_NAME , B.BOOK_ID , TITLE , P.PUB_NAME , AUTHOR_NAME , NO_OF_COPIES;


/* 2) Get the particulars of borrowers who have borrowed more than 3 books, 
but from Jan 2017 to Jun 2017. */
SELECT 
    CARD_NO
FROM
    BOOK_LENDING
WHERE
    DATE_OUT > '2017-01-01'
        AND DATE_OUT < '2017-06-01'
GROUP BY CARD_NO
HAVING COUNT(*) > 3;


/* 3) Delete a book in the BOOK table. Update the contents of other 
tables to reflect this data manipulation operation. */
DELETE FROM BOOK 
WHERE
    BOOK_ID = 001;
SELECT 
    *
FROM
    BOOK;


/* 4) Partition the BOOK table based on year of publication. Demonstrate its working with a simple query. */
SELECT 
    PUB_YEAR
FROM
    BOOK;


/* 5) Create a view of all books and its number of copies that are currently available in the library. */
CREATE VIEW BOOKS_AVAILABLE AS
    SELECT 
        B.BOOK_ID, B.TITLE, C.NO_OF_COPIES
    FROM
        LIBRARY_PROGRAM L,
        BOOK B,
        BOOK_COPIES C
    WHERE
        B.BOOK_ID = C.BOOK_ID
            AND L.PGM_ID = C.PGM_ID;
SELECT 
    *
FROM
    BOOKS_AVAILABLE;

















